<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chuyển giọng nói thành văn bản</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; background-color: #f0f2f5; }
        #recordButton {
            padding: 20px;
            font-size: 1.2em;
            cursor: pointer;
            border-radius: 50%;
            border: none;
            width: 100px;
            height: 100px;
            background-color: #dc3545;
            color: white;
            transition: background-color 0.3s, transform 0.1s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        #recordButton.recording {
            background-color: #28a745;
            transform: scale(1.1);
        }
        #transcript {
            margin-top: 30px;
            width: 80%;
            max-width: 600px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 8px;
            min-height: 100px;
            background-color: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .final-transcript { font-weight: bold; }
    </style>
</head>
<body>

    <button id="recordButton">Nhấn nói</button>
    <div id="transcript">
        <p><em>Văn bản chuyển đổi sẽ xuất hiện ở đây...</em></p>
    </div>

    <script>
        const recordButton = document.getElementById('recordButton');
        const transcriptDiv = document.getElementById('transcript');
        let recognition;
        let isRecording = false;

        // Kiểm tra trình duyệt có hỗ trợ Web Speech API không
        window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!window.SpeechRecognition) {
            alert("Trình duyệt của bạn không hỗ trợ Speech Recognition. Hãy thử Chrome hoặc Edge.");
        } else {
            recognition = new SpeechRecognition();
            recognition.continuous = true; // Nhận dạng liên tục
            recognition.interimResults = true; // Trả về kết quả tạm thời
            recognition.lang = 'vi-VN'; // Đặt ngôn ngữ là Tiếng Việt

            recognition.onstart = () => {
                isRecording = true;
                recordButton.textContent = 'Đang ghi...';
                recordButton.classList.add('recording');
                transcriptDiv.innerHTML = '<p><em>Đang nghe...</em></p>';
            };

            recognition.onend = () => {
                isRecording = false;
                recordButton.textContent = 'Nhấn nói';
                recordButton.classList.remove('recording');
            };

            recognition.onerror = (event) => {
                console.error("Lỗi Speech Recognition:", event.error);
                if(event.error === 'not-allowed') {
                    alert('Bạn đã chặn quyền truy cập micro. Vui lòng cho phép để sử dụng tính năng này.');
                }
            };

            recognition.onresult = (event) => {
                let interimTranscript = '';
                let finalTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    if (event.results[i].isFinal) {
                        finalTranscript += event.results[i][0].transcript;
                    } else {
                        interimTranscript += event.results[i][0].transcript;
                    }
                }
                
                // Hiển thị kết quả trực tiếp lên web
                transcriptDiv.innerHTML = `<span class="final-transcript">${finalTranscript}</span><span class="interim-transcript">${interimTranscript}</span>`;
            };
        }

        recordButton.addEventListener('click', () => {
            if (!isRecording) {
                // Yêu cầu quyền truy cập micro và bắt đầu nhận dạng
                navigator.mediaDevices.getUserMedia({ audio: true })
                    .then(() => {
                        recognition.start();
                    })
                    .catch((err) => {
                        alert("Không thể truy cập micro. Vui lòng cấp quyền.");
                        console.error("Lỗi getUserMedia:", err);
                    });
            } else {
                recognition.stop();
            }
        });
    </script>
</body>
</html>
